"use strict";(()=>{var x="leetcode-ai-analyzer-card",d="leetcode-ai-analyzer-button",h="leetcode-ai-analyzer",w="accepted",E=typeof process<"u"&&process.env?.NEXT_PUBLIC_ANALYZE_ENDPOINT||"http://localhost:3000/api/analyze",C=()=>/^https:\/\/leetcode\.com\/problems\//.test(window.location.href),A=(n,e=20,t=250)=>new Promise(o=>{let r=0,s=()=>{let a=n();if(a||r>=e){o(a??null);return}r+=1,window.setTimeout(s,t)};s()}),S=async n=>{let t=new TextEncoder().encode(n),o=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map(r=>r.toString(16).padStart(2,"0")).join("")},v=n=>new Promise(e=>{try{chrome.storage.local.get(n,t=>{let o=t[n];e(o??null)})}catch(t){console.error("Storage get error",t),e(null)}}),T=(n,e)=>new Promise(t=>{try{chrome.storage.local.set({[n]:e},()=>t())}catch(o){console.error("Storage set error",o),t()}}),I=()=>{let e=window.monaco?.editor?.getModels?.()?.[0],t=e?.getValue?.()??"",r=e?.getLanguageId?.()||L()||"javascript";return{code:t,language:r}},L=()=>{let n=["[data-cy=lang-select] .ant-select-selection-item","[data-cy=lang-select] .select-style",".language-select .ant-select-selection-item","[class*='language'] [class*='select']"];for(let o of n){let s=document.querySelector(o)?.textContent?.trim();if(s)return s.toLowerCase()}let t=document.querySelector(".monaco-editor")?.getAttribute("aria-label")?.toLowerCase();if(t&&t.includes("editor")){let o=t.match(/editor\s+content\s+.*?\s+(\w+)/);if(o?.[1])return o[1].toLowerCase()}return null},P=(n,e)=>`${h}:${n}:${e}`,z=()=>{let n=document.getElementById(x);n&&n.remove()},c=(n,e=!1)=>{z();let t=document.createElement("div");t.id=x,t.style.position="fixed",t.style.bottom="16px",t.style.right="16px",t.style.width="320px",t.style.maxWidth="90vw",t.style.background="#0f172a",t.style.color="#e2e8f0",t.style.border="1px solid #1f2937",t.style.borderRadius="8px",t.style.boxShadow="0 12px 30px rgba(0,0,0,0.35)",t.style.padding="14px 16px",t.style.fontFamily="Inter, system-ui, -apple-system, sans-serif",t.style.zIndex="2147483646",t.style.backdropFilter="blur(8px)",t.style.cursor="default";let o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.justifyContent="space-between",o.style.marginBottom="10px";let r=document.createElement("div");r.textContent=e?"Analysis Error":"Time & Space",r.style.fontWeight="600",r.style.fontSize="14px";let s=document.createElement("button");s.textContent="\u2715",s.style.background="transparent",s.style.border="none",s.style.color="#94a3b8",s.style.cursor="pointer",s.style.fontSize="14px",s.addEventListener("click",()=>t.remove()),o.appendChild(r),o.appendChild(s),t.appendChild(o);let a=document.createElement("div");a.style.fontSize="13px",a.style.lineHeight="1.45",a.textContent=n,e&&(a.style.color="#fca5a5"),t.appendChild(a),document.body.appendChild(t)},u=n=>{let e=[`Time: ${n.time}`,`Space: ${n.space}`,n.explanation];c(e.join(`
`))},y=n=>{c(n,!0)},m=(n,e)=>{e==="loading"?(n.disabled=!0,n.textContent="Analyzing..."):(n.disabled=!1,n.textContent="Analyze Time & Space")},g=n=>{if(document.getElementById(d))return;let e=document.createElement("button");e.id=d,e.textContent="Analyze Time & Space",e.style.marginLeft="8px",e.style.padding="8px 12px",e.style.borderRadius="6px",e.style.border="1px solid #1f2937",e.style.background="#111827",e.style.color="#e2e8f0",e.style.cursor="pointer",e.style.fontSize="12px",e.style.fontWeight="600",e.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)",e.style.transition="transform 120ms ease, box-shadow 120ms ease",e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-1px)",e.style.boxShadow="0 10px 20px rgba(0,0,0,0.25)"}),e.addEventListener("mouseleave",()=>{e.style.transform="translateY(0)",e.style.boxShadow="0 6px 16px rgba(0,0,0,0.2)"}),e.addEventListener("click",async()=>{m(e,"loading");try{let{code:t,language:o}=I();if(!t.trim()){y("Could not read your code from the editor.");return}let r=await S(t),s=P(o,r),a=await v(s);if(a){u(a);return}c("Analyzing with OpenAI...");let l=await fetch(E,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,language:o})});if(!l.ok){let b=await l.text();throw new Error(b||"Request failed")}let i=await l.json();await T(s,i),u(i)}catch(t){console.error("Analysis error",t),y("Unable to analyze submission. Please try again.")}finally{m(e,"idle")}}),n.parentElement?n.parentElement.appendChild(e):n.appendChild(e)},p=n=>n?.toLowerCase().includes(w)??!1,f=n=>{let e=["[data-e2e-locator='submission-result']","[data-cy='judge-status']","[data-cy='submission-result']","[class*='accept']","[role='alert']"];for(let r of e){let a=Array.from(n.querySelectorAll(r)).find(l=>p(l.textContent));if(a)return a}return Array.from(n.querySelectorAll("span, div, p, strong, h1, h2, h3, button")).find(r=>p(r.textContent))??null},M=()=>{let n=document.body;if(!n)return;let e=f(n);e&&g(e);let t=!!e,o=()=>{let a=f(document.body);a&&(g(a),t=!0)};new MutationObserver(()=>{o()}).observe(n,{childList:!0,subtree:!0,characterData:!0});let s=window.setInterval(()=>{if(t){window.clearInterval(s);return}o()},1500)},R=async()=>{C()&&(await A(()=>document.getElementById("__next")),M())};R().catch(n=>console.error("Initialization error",n));})();
